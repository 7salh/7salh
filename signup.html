<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</title>

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#0f2027);
  background-size:400% 400%;
  animation:move 12s ease infinite;
  font-family:Tahoma;
  color:#fff;
}
@keyframes move{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
form{
  width:320px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
h1{text-align:center}
input,select,button{
  padding:12px;
  border-radius:20px;
  border:2px solid #00e6ff;
  background:rgba(0,0,0,.2);
  color:#fff;
  font-size:1rem;
}
button{
  background:#00e6ff;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
.error{
  color:#ff4d4d;
  font-size:.9rem;
}
</style>
</head>

<body>

<form id="signupForm">
  <h1>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h1>

  <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
  <input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
  <input id="confirm" type="password" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>

  <select id="ageGroup" required>
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</option>
    <option value="10-18">10 - 18</option>
    <option value="19-25">19 - 25</option>
    <option value="25-30">25 - 30</option>
    <option value="30-40">30 - 40</option>
    <option value="40+">40+</option>
  </select>

  <input id="iban" placeholder="SAxxxxxxxxxxxxxxxxx" required>

  <div id="error" class="error"></div>
  <button type="submit">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB-hbThdD4r_3V5L0ZC-Jqd5VW5VmvjrJE",
  authDomain: "salh-2e2e7.firebaseapp.com",
  projectId: "salh-2e2e7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const form = document.getElementById("signupForm");
const errorDiv = document.getElementById("error");

const usernameInput = document.getElementById("username");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const confirmInput = document.getElementById("confirm");
const ageGroupSelect = document.getElementById("ageGroup");
const ibanInput = document.getElementById("iban");

/* IBAN: SA + 17 Ø±Ù‚Ù… ÙÙ‚Ø· */
ibanInput.value = "SA";
ibanInput.addEventListener("input", () => {
  ibanInput.value = "SA" + ibanInput.value.replace(/[^0-9]/g,"").slice(0,17);
});

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  errorDiv.textContent = "";

  const username = usernameInput.value.trim();
  const email = emailInput.value.trim();
  const password = passwordInput.value;
  const confirm = confirmInput.value;
  const ageGroup = ageGroupSelect.value;
  const iban = ibanInput.value;

  if(password.length < 6)
    return errorDiv.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„";

  if(password !== confirm)
    return errorDiv.textContent = "ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†";

  if(iban.length !== 19)
    return errorDiv.textContent = "Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† ØºÙŠØ± ØµØ­ÙŠØ­";

  try{
    // ğŸ”¹ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ (ÙŠØ³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§)
    const cred = await createUserWithEmailAndPassword(auth,email,password);

    await updateProfile(cred.user,{ displayName: username });

    await setDoc(doc(db,"users",cred.user.uid),{
      displayName: username,
      email,
      ageGroup,
      iban,
      balance: 0,
      role: "user",
      createdAt: Date.now()
    });

    // âœ… Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ + ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    location.replace("./index.html");

  }catch(err){
    console.error(err);
    errorDiv.textContent = err.message;
  }
});
</script>

</body>
</html>
