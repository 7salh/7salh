<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

// ðŸ”¹ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ firebaseConfig Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…Ø´Ø±ÙˆØ¹Ùƒ
const firebaseConfig = {
  apiKey: "AIzaSyXXXX...",
  authDomain: "7salh.firebaseapp.com",
  projectId: "7salh",
  storageBucket: "7salh.appspot.com",
  messagingSenderId: "XXXX",
  appId: "1:XXXX:web:XXXX",
  measurementId: "G-XXXX"
};

const app = initializeApp(firebaseConfig);
console.log("Connected Firebase Project ID:", app.options.projectId);

const auth = getAuth(app);
const db = getFirestore(app);

const signupForm = document.getElementById('signupForm');
const errorDiv = document.getElementById('error');
const successDiv = document.getElementById('success');

signupForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  errorDiv.textContent = '';
  successDiv.textContent = '';

  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const age = document.getElementById('age').value;
  const ageGroup = document.getElementById('ageGroup').value;
  const region = document.getElementById('region').value;

  if (password !== confirmPassword) {
    errorDiv.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†.";
    return;
  }

  try {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Authentication
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    await updateProfile(userCredential.user, { displayName: username });

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Firestore
    await setDoc(doc(db, "users", userCredential.user.uid), {
      displayName: username,
      email: email,
      age: parseInt(age),
      ageGroup: ageGroup,
      region: region,
      createdAt: new Date()
    });

    successDiv.textContent = "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!";
    signupForm.reset();

    setTimeout(() => {
      window.location.href = "login.html"; // ØªØ­ÙˆÙŠÙ„ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    }, 1500);

  } catch (err) {
    console.error(err);
    errorDiv.textContent = err.message;
  }
});
</script>
