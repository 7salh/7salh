<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول</title>
<style>
body{margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#0f2027);
background-size:400% 400%;animation:gradientMove 12s ease infinite;
font-family:Tahoma;color:#fff}
@keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
form{width:300px;display:flex;flex-direction:column}
input,button{margin:8px 0;padding:12px;border-radius:20px;border:2px solid #00e6ff;background:rgba(0,0,0,.2);color:#fff}
button{background:#00e6ff;color:#000;font-weight:bold;cursor:pointer}
.error{color:#ff4d4d;font-size:.9rem}
</style>
</head>
<body>

<form id="loginForm">
  <input id="identifier" placeholder="البريد أو اسم المستخدم" required>
  <input id="password" type="password" placeholder="كلمة المرور" required>
  <div id="error" class="error"></div>
  <button>تسجيل الدخول</button>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB-hbThdD4r_3V5L0ZC-Jqd5VW5VmvjrJE",
  authDomain: "salh-2e2e7.firebaseapp.com",
  projectId: "salh-2e2e7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const form = document.getElementById("loginForm");
const errorDiv = document.getElementById("error");

form.onsubmit = async e => {
  e.preventDefault();
  errorDiv.textContent = "";

  let identifier = identifier.value.trim();
  const pass = password.value;

  try {
    if(!identifier.includes("@")){
      const q = query(collection(db,"users"), where("displayName","==",identifier));
      const snap = await getDocs(q);
      if(snap.empty) throw new Error("اسم المستخدم غير موجود");
      identifier = snap.docs[0].data().email;
    }

    await signInWithEmailAndPassword(auth, identifier, pass);
    location.href="index.html";
  } catch(err){
    errorDiv.textContent = err.message;
  }
};
</script>

</body>
</html>
